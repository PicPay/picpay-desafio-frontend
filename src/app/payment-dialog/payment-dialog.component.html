<h1 mat-dialog-title>
  Pagamento para <span>{{ destinationUser.name }}</span>
</h1>

<div mat-dialog-content>
  <form *ngIf="!processingTransaction && !processingFailed && !transactionResponse"
        [formGroup]="paymentInfoFormGroup"
        fxLayout="column">
    <mat-form-field appearance="outline">
      <mat-label>Valor (R$)</mat-label>
      <input [(ngModel)]="paymentInfo.value" matInput formControlName="value" placeholder="R$ 0,00"
             currencyMask [options]="{ prefix: 'R$ ', thousands: '.', decimal: ',', align: 'left' }">
      <mat-error>Insira o valor do pagamento</mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Forma de pagamento</mat-label>
      <mat-select [(ngModel)]="paymentInfo.creditCard" formControlName="creditCard">
        <mat-option *ngFor="let card of cards" [value]="card">
          Cartão com final {{ card.cardNumber.substr(-4) }}
        </mat-option>
      </mat-select>
      <mat-error>Escolha um método de pagamento</mat-error>
    </mat-form-field>
  </form>

  <ng-container *ngIf="processingTransaction">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  </ng-container>

  <ng-container *ngIf="transactionResponse && transactionResponse.success">
    <span class="transaction-status success">O pagamento foi concluido com sucesso!</span>
  </ng-container>

  <ng-container *ngIf="processingFailed || (transactionResponse && !transactionResponse.success)">
    <span class="transaction-status failed">O pagamento <strong>não</strong> foi concluido com sucesso.</span>
  </ng-container>
</div>

<div mat-dialog-actions>
  <ng-container *ngIf="!processingTransaction && !processingFailed && !transactionResponse">
    <button mat-stroked-button cdkFocusInitial (click)="close()">Cancelar</button>
    <button mat-stroked-button color="primary" (click)="submitPayment()">Pagar</button>
  </ng-container>

  <ng-container *ngIf="transactionResponse || processingFailed">
    <button mat-stroked-button cdkFocusInitial (click)="close()">Fechar</button>
  </ng-container>
</div>